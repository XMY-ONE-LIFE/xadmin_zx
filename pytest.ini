[pytest]
# ==================== Django 配置 ====================
DJANGO_SETTINGS_MODULE = xadmin.settings
python_files = tests.py test_*.py *_test.py

python_classes = Test*
python_functions = test_*

# ==================== 测试路径配置 ====================
# 指定测试文件的搜索路径
testpaths = 
    tests
    ; xadmin_auth/tests
    ; xadmin_tpgen/tests
    yaml_check/tests
    ; yaml_test_plan/tests
    tpgen/tests
    ; web/src/views/tpgen/online/tests  # web目录在norecursedirs中，需要单独运行：pytest web/src/views/tpgen/online/tests/


# ==================== 输出配置 ====================
# 详细输出模式
addopts = 
    -v
    --strict-markers
    --tb=short
    --color=yes
    --code-highlight=yes
    # 显示测试覆盖率
    --cov=.
    --cov-report=html
    --cov-report=term-missing:skip-covered
    --cov-config=.coveragerc
    # 显示慢测试（超过1秒）
    --durations=10
    --durations-min=1.0
    # 失败时显示局部变量
    --showlocals
    # 并行测试（可选，根据CPU核心数调整）
    # -n auto
    # 重新运行失败的测试
    --lf
    --ff

# ==================== 标记配置 ====================
markers =
    slow: 标记慢速测试（运行时间超过5秒）
    integration: 标记集成测试
    unit: 标记单元测试
    api: 标记API测试
    db: 标记需要数据库的测试
    auth: 标记认证相关测试
    yaml: 标记YAML验证相关测试
    tpgen: 标记测试计划生成相关测试
    smoke: 标记冒烟测试

# ==================== 日志配置 ====================
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] [%(name)s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] [%(name)s:%(lineno)d] %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# ==================== 警告配置 ====================
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning

# ==================== 其他配置 ====================
# 最小Python版本要求
minversion = 7.0

# 禁用递归搜索某些目录
norecursedirs = 
    .git
    .tox
    dist
    build
    *.egg
    __pycache__
    .venv
    venv
    node_modules
    web
    logs
    data

# 文档字符串格式
doctest_optionflags = NORMALIZE_WHITESPACE IGNORE_EXCEPTION_DETAIL

# 超时配置（可选，需要安装 pytest-timeout）
# timeout = 300
# timeout_method = thread

# ==================== 数据库配置提示 ====================
# 注意：Django测试会自动创建测试数据库
# 如果需要使用特定的测试数据库配置，请在 conftest.py 中设置

# ==================== 环境变量配置 ====================
# 可以在这里设置测试环境变量
# env =
#     DJANGO_DEBUG=False
#     TESTING=True

